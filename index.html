<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">
 
    <title>Socrata Data Portal Analytics Viewer</title>
 
 
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
 
    <!-- Custom styles for this template -->
    <link href="starter-template.css" rel="stylesheet">
 
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="../../assets/js/ie-emulation-modes-warning.js"></script>
 
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
 
    <style type="text/css">
        body {
            padding-top: 65px;
        }
        #results {
            background: #ccc;
            padding: 20px;
        }
    </style>
  </head>
 
  <body>
 
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Socrata Data Portal Analytics Viewer</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="#contact">Contact</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
 
    <div class="container">
 
        <div class="row">
            <h1>Welcome</h1>
            <p class="lead">This tool gathers Socrata Data Portal analytics for the time period of your choosing.</p>
 
            <form id="builder" class="form-horizontal">
                <div class="form-group">
                    <label>Data portal</label>
                    <select id="data-portal" class="form-control">
                      <option>data.austintexas.gov</option>
                      <option>data.cityofnewyork.us</option>
                      <option>data.hawaii.gov</option>
                      <option>bronx.lehman.cuny.edu</option>
                      <option>data.sfgov.org</option>
                      <option>data.baltimorecity.gov</option>
                      <option>data.raleighnc.gov</option>
                      <option>data.ok.gov</option>
                      <option>data.seattle.gov</option>
                      <option>data.montgomerycountymd.gov</option>
                      <option>finances.worldbank.org</option>
                      <option>data.cityofboston.gov</option>
                      <option>data.act.gov.au</option>
                      <option>data.kcmo.org</option>
                    </select>
                </div>
 
               <!--  <div class="form-group">
                        <label for="start-date">Start Date</label>
                        <input id="start-date" type="date" value="2013-01-01">
                        <span class="result"></span>
                </div>
                <div class="form-group">
                        <label for="end-date">End Date</label>
                        <input id="end-date" type="date" value="2013-12-31">
                        <span class="result"></span>
                </div> -->
                <div class="form-group">
                  <label>Year</label>
                  <select name="" id="year" class="form-control">
                    <option>2012</option>
                    <option>2013</option>
                    <option>2014</option>
                  </select>
                </div>

              <button class="btn btn-success">Get Socrata Data</button>
            </form>
        </div>
        
 
        <div class="row">
            <div id="results"></div>
        </div>
    <br>    
            <form>
                  <div class="row">
                      <div id="displayData"></div>
                  </div>  
            </form>
 
      </div>
 
    </div><!-- /.container -->
 
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="../../dist/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>
    <script>


// Create the URL

var months2012 = [
    '/api/site_metrics.json?start=1325376000000&end=1327968000000',
    '/api/site_metrics.json?start=1328054400000&end=1330387200000',
    '/api/site_metrics.json?start=1330560000000&end=1333152000000',
    '/api/site_metrics.json?start=1333238400000&end=1335744000000',
    '/api/site_metrics.json?start=1335830400000&end=1338422400000',
    '/api/site_metrics.json?start=1338508800000&end=1341014400000',
    '/api/site_metrics.json?start=1341100800000&end=1343692800000',
    '/api/site_metrics.json?start=1343779200000&end=1346371200000',
    '/api/site_metrics.json?start=1346457600000&end=1348963200000',
    '/api/site_metrics.json?start=1349049600000&end=1351641600000',
    '/api/site_metrics.json?start=1351728000000&end=1354233600000',
    '/api/site_metrics.json?start=1354320000000&end=1356912000000'];

var months2013 = [
    '/api/site_metrics.json?start=1356998400000&end=1359590400000',
    '/api/site_metrics.json?start=1359676800000&end=1362009600000',
    '/api/site_metrics.json?start=1362096000000&end=1364688000000',
    '/api/site_metrics.json?start=1364774400000&end=1367280000000',
    '/api/site_metrics.json?start=1367366400000&end=1369958400000',
    '/api/site_metrics.json?start=1370044800000&end=1372550400000',
    '/api/site_metrics.json?start=1372636800000&end=1375228800000',
    '/api/site_metrics.json?start=1375315200000&end=1377907200000',
    '/api/site_metrics.json?start=1377993600000&end=1380499200000',
    '/api/site_metrics.json?start=1380585600000&end=1383177600000',
    '/api/site_metrics.json?start=1383264000000&end=1385769600000',
    '/api/site_metrics.json?start=1385856000000&end=1388448000000'];


var months2014 = [
    '/api/site_metrics.json?start=1388534400000&end=1391126400000',
    '/api/site_metrics.json?start=1391212800000&end=1393545600000',
    '/api/site_metrics.json?start=1393632000000&end=1396224000000',
    '/api/site_metrics.json?start=1396310400000&end=1398816000000',
    '/api/site_metrics.json?start=1398902400000&end=1401494400000',
    '/api/site_metrics.json?start=1401580800000&end=1404086400000',
    '/api/site_metrics.json?start=1404172800000&end=1406764800000',
    '/api/site_metrics.json?start=1406851200000&end=1409443200000',
    '/api/site_metrics.json?start=1409529600000&end=1412035200000',
    '/api/site_metrics.json?start=1412121600000&end=1414713600000',
    '/api/site_metrics.json?start=1414800000000&end=1417305600000',
    '/api/site_metrics.json?start=1417392000000&end=1419984000000'];




        $currentURL = '';
        var $results = document.getElementById("results");
        var $dataPortal = document.getElementById("data-portal");
        var $yearSelected = document.getElementById("year")
        // var $startDate = document.getElementById("start-date");
        // var $endDate = document.getElementById("end-date"); 

        /**** 
        ** Since we commented out the startDate & endData fields, this fuction breaks the script 
        ***/

        // function updateResults() {
            // var url = "https://" + $dataPortal.value + "/api/site_metrics.json?start=" + Date.parse($startDate.value)  + "&end=" + Date.parse($endDate.value);
            // console.log("update", url);
            // $results.innerHTML = "<a href='" + url + "'>" + url + "</a>";
            // $currentURL = url;
             
        // }

        // $dataPortal.onchange = updateResults;
        // $yearSelected.onchange = updateResults;
        // $startDate.onchange = updateResults;
        // $endDate.onchange = updateResults;

        // updateResults();

// Display data from URL on page
        var $displayData = document.getElementById("displayData");
        
        function clearOutputs(){
          $('#displayData').text('');
          $('#results').text('');
          dataObj = [];
        }

        function displayData() {
          var URL = $currentURL;
          var currentEndpoint = '';

          $('button').click(function(e){
            e.preventDefault();
            clearOutputs();
            $('#results').append("<p>Fetched data from: </p>");
            for (i=0; i < 12; i++){

              if ( $yearSelected.value === '2014' ){
                currentEndpoint = "https://" + $dataPortal.value + months2014[i];
              } else if ( $yearSelected.value === '2013' ){
                currentEndpoint = "https://" + $dataPortal.value + months2013[i];
              } else {
                currentEndpoint = "https://" + $dataPortal.value + months2012[i];
              }

              console.log("Requesting data from: " + currentEndpoint);
              $('#results').append("<a href='" + currentEndpoint + "'>" + currentEndpoint + "</a><br>");
              $.ajax({
                  url: currentEndpoint,
                  type: "GET",
                  dataType: "json",
                  dataObj: [],
              }).done(function(data, status, jqXHR) {
                var socrataData = data;
                console.log("Status: " + status);
                // console.log(socrataData);
                dataObj.push(jqXHR.responseText);
                // console.log(dataObj);
                $('#displayData').text('[' + dataObj + ']');

              }).fail(function(xhr, status, err) {
                  console.log('fail', status, err);
              });
            }
          });
      }


      // $results.onchange = updateResults;

      displayData();


      

      </script>
 
  </body>
</html>